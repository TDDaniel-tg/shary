(()=>{var e={};e.id=7758,e.ids=[7758],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},5486:e=>{"use strict";e.exports=require("bcrypt")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},32170:(e,t,s)=>{"use strict";s.a(e,async(e,r)=>{try{s.d(t,{F:()=>c});var a=s(64939),i=s(5486),n=s.n(i),o=e([a]);let u=new(a=(o.then?(await o)():o)[0]).Pool({user:process.env.DB_USER||"postgres",host:process.env.DB_HOST||"localhost",database:process.env.DB_NAME||"prime_balloons",password:process.env.DB_PASSWORD||"password",port:parseInt(process.env.DB_PORT||"5432"),ssl:{rejectUnauthorized:!1}});class c{static async getAll(e){let t="SELECT * FROM users WHERE 1=1",s=[],r=1;return e?.active!==void 0&&(t+=` AND is_active = $${r}`,s.push(e.active),r++),t+=" ORDER BY created_at DESC",e?.limit&&(t+=` LIMIT $${r}`,s.push(e.limit),r++),e?.offset&&(t+=` OFFSET $${r}`,s.push(e.offset)),(await u.query(t,s)).rows}static async getById(e){return(await u.query("SELECT * FROM users WHERE id = $1 AND is_active = true",[e])).rows[0]||null}static async getByEmail(e){return(await u.query("SELECT * FROM users WHERE email = $1",[e])).rows[0]||null}static async getByPhone(e){return(await u.query("SELECT * FROM users WHERE phone = $1",[e])).rows[0]||null}static async create(e){let t=e.password?await n().hash(e.password,10):null,s=`
      INSERT INTO users (
        email, password_hash, phone, first_name, last_name, middle_name
      ) VALUES ($1, $2, $3, $4, $5, $6) 
      RETURNING *
    `,r=[e.email,t,e.phone,e.first_name,e.last_name,e.middle_name];return(await u.query(s,r)).rows[0]}static async update(e,t){let s=[],r=[],a=1;if(Object.entries(t).forEach(([e,t])=>{"id"!==e&&"created_at"!==e&&"updated_at"!==e&&void 0!==t&&(s.push(`${e} = $${a}`),r.push(t),a++)}),0===s.length)return null;let i=`
      UPDATE users 
      SET ${s.join(", ")} 
      WHERE id = $${a} 
      RETURNING *
    `;return r.push(e),(await u.query(i,r)).rows[0]||null}static async updatePassword(e,t){let s=await n().hash(t,10);return((await u.query("UPDATE users SET password_hash = $2 WHERE id = $1",[e,s])).rowCount??0)>0}static async verifyPassword(e,t){let s=await this.getByEmail(e);return s&&s.password_hash&&await n().compare(t,s.password_hash)?s:null}static async verifyEmail(e){return((await u.query("UPDATE users SET email_verified = true WHERE id = $1",[e])).rowCount??0)>0}static async verifyPhone(e){return((await u.query("UPDATE users SET phone_verified = true WHERE id = $1",[e])).rowCount??0)>0}static async updateStats(e,t){let s=`
      UPDATE users 
      SET 
        total_orders = total_orders + 1,
        total_spent = total_spent + $2
      WHERE id = $1
    `;await u.query(s,[e,t])}static async applyDiscount(e,t){return((await u.query("UPDATE users SET discount = $2 WHERE id = $1",[e,t])).rowCount??0)>0}static async deactivate(e){return((await u.query("UPDATE users SET is_active = false WHERE id = $1",[e])).rowCount??0)>0}static async getLoyalCustomers(e=5){return(await u.query("SELECT * FROM users WHERE total_orders >= $1 AND is_active = true ORDER BY total_spent DESC",[e])).rows}}r()}catch(e){r(e)}})},42605:(e,t,s)=>{"use strict";s.a(e,async(e,r)=>{try{s.r(t),s.d(t,{patchFetch:()=>c,routeModule:()=>p,serverHooks:()=>E,workAsyncStorage:()=>l,workUnitAsyncStorage:()=>d});var a=s(96559),i=s(48088),n=s(37719),o=s(64555),u=e([o]);o=(u.then?(await u)():u)[0];let p=new a.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/auth/login/route",pathname:"/api/auth/login",filename:"route",bundlePath:"app/api/auth/login/route"},resolvedPagePath:"C:\\Users\\HP\\Desktop\\work\\project\\app\\api\\auth\\login\\route.ts",nextConfigOutput:"",userland:o}),{workAsyncStorage:l,workUnitAsyncStorage:d,serverHooks:E}=p;function c(){return(0,n.patchFetch)({workAsyncStorage:l,workUnitAsyncStorage:d})}r()}catch(e){r(e)}})},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},64555:(e,t,s)=>{"use strict";s.a(e,async(e,r)=>{try{s.r(t),s.d(t,{POST:()=>c});var a=s(32190),i=s(32170),n=s(80829),o=s.n(n),u=e([i]);async function c(e){try{let{email:t,password:s}=await e.json();if(!t||!s)return a.NextResponse.json({success:!1,error:"Email and password are required"},{status:400});let r=await i.F.verifyPassword(t,s);if(!r)return a.NextResponse.json({success:!1,error:"Invalid credentials"},{status:401});if(!r.is_active)return a.NextResponse.json({success:!1,error:"Account is deactivated"},{status:401});let n=o().sign({userId:r.id,email:r.email,role:r.role},process.env.JWT_SECRET||"default-secret",{expiresIn:"7d"}),{password_hash:u,...c}=r;return a.NextResponse.json({success:!0,data:{user:c,token:n}})}catch(e){return a.NextResponse.json({success:!1,error:"Failed to login"},{status:500})}}i=(u.then?(await u)():u)[0],r()}catch(e){r(e)}})},64939:e=>{"use strict";e.exports=import("pg")},78335:()=>{},80829:e=>{"use strict";e.exports=require("jsonwebtoken")},96487:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[7719,580],()=>s(42605));module.exports=r})();