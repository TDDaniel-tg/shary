{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 72, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Desktop/work/project/lib/models/Product.ts"],"sourcesContent":["import { Pool } from 'pg';\r\n\r\nconst pool = new Pool({\r\n  user: process.env.DB_USER || 'postgres',\r\n  host: process.env.DB_HOST || 'localhost',\r\n  database: process.env.DB_NAME || 'balloons_store',\r\n  password: process.env.DB_PASSWORD || 'password',\r\n  port: parseInt(process.env.DB_PORT || '5432'),\r\n  ssl: process.env.DB_SSL === 'true' ? { rejectUnauthorized: false } : false,\r\n});\r\n\r\nexport interface Product {\r\n  id: number;\r\n  name: string;\r\n  slug: string;\r\n  description?: string;\r\n  short_description?: string;\r\n  price: number;\r\n  original_price?: number;\r\n  category_id?: number;\r\n  image_url?: string;\r\n  images?: string[];\r\n  rating: number;\r\n  reviews_count: number;\r\n  in_stock: boolean;\r\n  stock_quantity: number;\r\n  sku?: string;\r\n  tags?: string[];\r\n  meta_title?: string;\r\n  meta_description?: string;\r\n  is_featured: boolean;\r\n  is_active: boolean;\r\n  created_at: string;\r\n  updated_at: string;\r\n}\r\n\r\nexport class ProductModel {\r\n  \r\n  static async getAll(filters?: {\r\n    category?: string;\r\n    search?: string;\r\n    featured?: boolean;\r\n    limit?: number;\r\n    offset?: number;\r\n    store_id?: number;\r\n  }): Promise<Product[]> {\r\n    let query = `\r\n      SELECT p.*, c.name as category_name\r\n    `;\r\n    if (filters?.store_id) {\r\n      query += ', ps.stock_quantity';\r\n    }\r\n    query += ` FROM products p \r\n      LEFT JOIN categories c ON p.category_id = c.id \r\n    `;\r\n    if (filters?.store_id) {\r\n      query += 'LEFT JOIN product_stocks ps ON ps.product_id = p.id AND ps.store_id = $storeId$ ';\r\n    }\r\n    query += 'WHERE p.is_active = true';\r\n    const params: any[] = [];\r\n    let paramIndex = 1;\r\n    if (filters?.category) {\r\n      query += ` AND c.slug = $${paramIndex}`;\r\n      params.push(filters.category);\r\n      paramIndex++;\r\n    }\r\n    if (filters?.search) {\r\n      query += ` AND (p.name ILIKE $${paramIndex} OR p.description ILIKE $${paramIndex})`;\r\n      params.push(`%${filters.search}%`);\r\n      paramIndex++;\r\n    }\r\n    if (filters?.featured) {\r\n      query += ` AND p.is_featured = true`;\r\n    }\r\n    if (filters?.store_id) {\r\n      query += ` AND ps.stock_quantity > 0`;\r\n    }\r\n    query += ` ORDER BY p.sort_order ASC, p.created_at DESC`;\r\n    if (filters?.limit) {\r\n      query += ` LIMIT $${paramIndex}`;\r\n      params.push(filters.limit);\r\n      paramIndex++;\r\n    }\r\n    if (filters?.offset) {\r\n      query += ` OFFSET $${paramIndex}`;\r\n      params.push(filters.offset);\r\n    }\r\n    // Подстановка store_id\r\n    let finalQuery = query;\r\n    if (filters?.store_id) {\r\n      finalQuery = query.replace(/\\$storeId\\$/g, `$${paramIndex}`);\r\n      params.push(filters.store_id);\r\n    }\r\n    const result = await pool.query(finalQuery, params);\r\n    return result.rows;\r\n  }\r\n\r\n  static async getById(id: number): Promise<Product | null> {\r\n    const query = `\r\n      SELECT p.*, c.name as category_name \r\n      FROM products p \r\n      LEFT JOIN categories c ON p.category_id = c.id \r\n      WHERE p.id = $1 AND p.is_active = true\r\n    `;\r\n    const result = await pool.query(query, [id]);\r\n    return result.rows[0] || null;\r\n  }\r\n\r\n  static async getBySlug(slug: string): Promise<Product | null> {\r\n    const query = `\r\n      SELECT p.*, c.name as category_name \r\n      FROM products p \r\n      LEFT JOIN categories c ON p.category_id = c.id \r\n      WHERE p.slug = $1 AND p.is_active = true\r\n    `;\r\n    const result = await pool.query(query, [slug]);\r\n    return result.rows[0] || null;\r\n  }\r\n\r\n  static async getFeatured(limit: number = 8): Promise<Product[]> {\r\n    return this.getAll({ featured: true, limit });\r\n  }\r\n\r\n  static async getByCategory(categorySlug: string, limit?: number): Promise<Product[]> {\r\n    return this.getAll({ category: categorySlug, limit });\r\n  }\r\n\r\n  static async search(searchTerm: string, limit?: number): Promise<Product[]> {\r\n    return this.getAll({ search: searchTerm, limit });\r\n  }\r\n\r\n  static async create(productData: Omit<Product, 'id' | 'created_at' | 'updated_at'>): Promise<Product> {\r\n    const query = `\r\n      INSERT INTO products (\r\n        name, slug, description, short_description, price, original_price,\r\n        category_id, image_url, images, rating, reviews_count, in_stock,\r\n        stock_quantity, sku, tags, meta_title, meta_description, is_featured, is_active\r\n      ) VALUES (\r\n        $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19\r\n      ) RETURNING *\r\n    `;\r\n    \r\n    const params = [\r\n      productData.name,\r\n      productData.slug,\r\n      productData.description,\r\n      productData.short_description,\r\n      productData.price,\r\n      productData.original_price,\r\n      productData.category_id,\r\n      productData.image_url,\r\n      productData.images,\r\n      productData.rating,\r\n      productData.reviews_count,\r\n      productData.in_stock,\r\n      productData.stock_quantity,\r\n      productData.sku,\r\n      productData.tags,\r\n      productData.meta_title,\r\n      productData.meta_description,\r\n      productData.is_featured,\r\n      productData.is_active\r\n    ];\r\n\r\n    const result = await pool.query(query, params);\r\n    return result.rows[0];\r\n  }\r\n\r\n  static async update(id: number, productData: Partial<Product>): Promise<Product | null> {\r\n    const fields: string[] = [];\r\n    const params: any[] = [];\r\n    let paramIndex = 1;\r\n\r\n    Object.entries(productData).forEach(([key, value]) => {\r\n      if (key !== 'id' && key !== 'created_at' && key !== 'updated_at' && value !== undefined) {\r\n        fields.push(`${key} = $${paramIndex}`);\r\n        params.push(value);\r\n        paramIndex++;\r\n      }\r\n    });\r\n\r\n    if (fields.length === 0) return null;\r\n\r\n    const query = `\r\n      UPDATE products \r\n      SET ${fields.join(', ')} \r\n      WHERE id = $${paramIndex} \r\n      RETURNING *\r\n    `;\r\n    params.push(id);\r\n\r\n    const result = await pool.query(query, params);\r\n    return result.rows[0] || null;\r\n  }\r\n\r\n  static async delete(id: number): Promise<boolean> {\r\n    const query = 'UPDATE products SET is_active = false WHERE id = $1';\r\n    const result = await pool.query(query, [id]);\r\n    return (result.rowCount ?? 0) > 0;\r\n  }\r\n\r\n  static async updateStock(id: number, quantity: number): Promise<void> {\r\n    const query = 'UPDATE products SET stock_quantity = $2 WHERE id = $1';\r\n    await pool.query(query, [id, quantity]);\r\n  }\r\n\r\n  static async updateRating(productId: number): Promise<void> {\r\n    const query = `\r\n      UPDATE products \r\n      SET \r\n        rating = (SELECT AVG(rating) FROM reviews WHERE product_id = $1 AND is_approved = true),\r\n        reviews_count = (SELECT COUNT(*) FROM reviews WHERE product_id = $1 AND is_approved = true)\r\n      WHERE id = $1\r\n    `;\r\n    await pool.query(query, [productId]);\r\n  }\r\n} "],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 275, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/HP/Desktop/work/project/app/api/products/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\nimport { ProductModel } from '@/lib/models/Product';\r\n\r\ninterface Product {\r\n  id: number;\r\n  name: string;\r\n  price: number;\r\n  originalPrice?: number;\r\n  image: string;\r\n  rating: number;\r\n  reviews: number;\r\n  category: string;\r\n  inStock: boolean;\r\n  description: string;\r\n  tags: string[];\r\n}\r\n\r\n// Мокированные данные товаров\r\nconst products: Product[] = [\r\n  {\r\n    id: 1,\r\n    name: 'Набор воздушных шаров \"Радуга\"',\r\n    price: 1299,\r\n    originalPrice: 1599,\r\n    image: '/images/products/balloon.png',\r\n    rating: 4.8,\r\n    reviews: 124,\r\n    category: 'Воздушные шары',\r\n    inStock: true,\r\n    description: 'Яркий набор воздушных шаров в цветах радуги. Идеально подходит для детских праздников и дней рождения.',\r\n    tags: ['воздушные шары', 'детский праздник', 'радуга', 'день рождения']\r\n  },\r\n  {\r\n    id: 2,\r\n    name: 'Декор для дня рождения \"Принцесса\"',\r\n    price: 2499,\r\n    image: '/images/products/balloon.png',\r\n    rating: 4.9,\r\n    reviews: 89,\r\n    category: 'Детские праздники',\r\n    inStock: true,\r\n    description: 'Полный набор декораций для создания сказочного праздника маленькой принцессы.',\r\n    tags: ['принцесса', 'детский праздник', 'декор', 'розовый']\r\n  },\r\n  // Добавьте больше товаров по необходимости\r\n];\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const { searchParams } = new URL(request.url);\r\n    \r\n    const filters = {\r\n      category: searchParams.get('category') || undefined,\r\n      search: searchParams.get('search') || undefined,\r\n      featured: searchParams.get('featured') === 'true',\r\n      limit: searchParams.get('limit') ? parseInt(searchParams.get('limit')!) : undefined,\r\n      offset: searchParams.get('offset') ? parseInt(searchParams.get('offset')!) : undefined,\r\n    };\r\n\r\n    const products = await ProductModel.getAll(filters);\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      data: products,\r\n      count: products.length\r\n    });\r\n\r\n  } catch (error) {\r\n    console.error('Error fetching products:', error);\r\n    return NextResponse.json(\r\n      { \r\n        success: false, \r\n        error: 'Failed to fetch products' \r\n      },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const body = await request.json();\r\n    \r\n    // Базовая валидация\r\n    if (!body.name || !body.price) {\r\n      return NextResponse.json(\r\n        { \r\n          success: false, \r\n          error: 'Name and price are required' \r\n        },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Генерация slug из названия если не указан\r\n    if (!body.slug) {\r\n      body.slug = body.name\r\n        .toLowerCase()\r\n        .replace(/[^a-z0-9]/g, '-')\r\n        .replace(/-+/g, '-')\r\n        .replace(/^-|-$/g, '');\r\n    }\r\n\r\n    const product = await ProductModel.create(body);\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      data: product\r\n    }, { status: 201 });\r\n\r\n  } catch (error) {\r\n    console.error('Error creating product:', error);\r\n    return NextResponse.json(\r\n      { \r\n        success: false, \r\n        error: 'Failed to create product' \r\n      },\r\n      { status: 500 }\r\n    );\r\n  }\r\n} "],"names":[],"mappings":";;;;AAAA;AACA;;;;;;;AAgBA,8BAA8B;AAC9B,MAAM,WAAsB;IAC1B;QACE,IAAI;QACJ,MAAM;QACN,OAAO;QACP,eAAe;QACf,OAAO;QACP,QAAQ;QACR,SAAS;QACT,UAAU;QACV,SAAS;QACT,aAAa;QACb,MAAM;YAAC;YAAkB;YAAoB;YAAU;SAAgB;IACzE;IACA;QACE,IAAI;QACJ,MAAM;QACN,OAAO;QACP,OAAO;QACP,QAAQ;QACR,SAAS;QACT,UAAU;QACV,SAAS;QACT,aAAa;QACb,MAAM;YAAC;YAAa;YAAoB;YAAS;SAAU;IAC7D;CAED;AAEM,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAE5C,MAAM,UAAU;YACd,UAAU,aAAa,GAAG,CAAC,eAAe;YAC1C,QAAQ,aAAa,GAAG,CAAC,aAAa;YACtC,UAAU,aAAa,GAAG,CAAC,gBAAgB;YAC3C,OAAO,aAAa,GAAG,CAAC,WAAW,SAAS,aAAa,GAAG,CAAC,YAAa;YAC1E,QAAQ,aAAa,GAAG,CAAC,YAAY,SAAS,aAAa,GAAG,CAAC,aAAc;QAC/E;QAEA,MAAM,WAAW,MAAM,0HAAA,CAAA,eAAY,CAAC,MAAM,CAAC;QAE3C,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,MAAM;YACN,OAAO,SAAS,MAAM;QACxB;IAEF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;YACE,SAAS;YACT,OAAO;QACT,GACA;YAAE,QAAQ;QAAI;IAElB;AACF;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAE/B,oBAAoB;QACpB,IAAI,CAAC,KAAK,IAAI,IAAI,CAAC,KAAK,KAAK,EAAE;YAC7B,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;gBACE,SAAS;gBACT,OAAO;YACT,GACA;gBAAE,QAAQ;YAAI;QAElB;QAEA,4CAA4C;QAC5C,IAAI,CAAC,KAAK,IAAI,EAAE;YACd,KAAK,IAAI,GAAG,KAAK,IAAI,CAClB,WAAW,GACX,OAAO,CAAC,cAAc,KACtB,OAAO,CAAC,OAAO,KACf,OAAO,CAAC,UAAU;QACvB;QAEA,MAAM,UAAU,MAAM,0HAAA,CAAA,eAAY,CAAC,MAAM,CAAC;QAE1C,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,MAAM;QACR,GAAG;YAAE,QAAQ;QAAI;IAEnB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,2BAA2B;QACzC,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;YACE,SAAS;YACT,OAAO;QACT,GACA;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}